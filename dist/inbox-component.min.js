var InboxComponent=function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function e(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(){n=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var a=e&&e.prototype instanceof f?e:f,o=Object.create(a.prototype),i=new O(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(a,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw o;return M()}for(n.method=a,n.arg=o;;){var i=n.delegate;if(i){var s=w(i,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=l(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,i),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var d={};function f(){}function h(){}function p(){}var m={};u(m,o,(function(){return this}));var g=Object.getPrototypeOf,v=g&&g(g(S([])));v&&v!==e&&r.call(v,o)&&(m=v);var b=p.prototype=f.prototype=Object.create(m);function y(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(a,o,i,s){var u=l(t[a],t,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?e.resolve(d.__await).then((function(t){n("next",t,i,s)}),(function(t){n("throw",t,i,s)})):e.resolve(d).then((function(t){c.value=t,i(c)}),(function(t){return n("throw",t,i,s)}))}s(u.arg)}var a;this._invoke=function(t,r){function o(){return new e((function(e,a){n(t,r,e,a)}))}return a=a?a.then(o,o):o()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=l(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var a=r.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function $(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function S(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:M}}function M(){return{value:void 0,done:!0}}return h.prototype=p,u(b,"constructor",p),u(p,"constructor",h),h.displayName=u(p,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},y(x.prototype),u(x.prototype,i,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new x(c(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},y(b),u(b,s,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach($),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),$(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;$(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}function r(t,e,n,r,a,o,i){try{var s=t[o](i),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,a)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var i=t.apply(e,n);function s(t){r(i,a,o,s,u,"next",t)}function u(t){r(i,a,o,s,u,"throw",t)}s(void 0)}))}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,s=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(t){s=!0,a=t}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var u,c,l,d=(u=function(t,e){t.exports=function(){var t=1e3,e=6e4,n=36e5,r="millisecond",a="second",o="minute",i="hour",s="day",u="week",c="month",l="quarter",d="year",f="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},v=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},b={s:v,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),a=n%60;return(e<=0?"+":"-")+v(r,2,"0")+":"+v(a,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),a=e.clone().add(r,c),o=n-a<0,i=e.clone().add(r+(o?-1:1),c);return+(-(r+(n-a)/(o?a-i:i-a))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:d,w:u,d:s,D:f,h:i,m:o,s:a,ms:r,Q:l}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},y="en",x={};x[y]=g;var w=function(t){return t instanceof S},_=function t(e,n,r){var a;if(!e)return y;if("string"==typeof e){var o=e.toLowerCase();x[o]&&(a=o),n&&(x[o]=n,a=o);var i=e.split("-");if(!a&&i.length>1)return t(i[0])}else{var s=e.name;x[s]=e,a=s}return!r&&a&&(y=a),a||!r&&y},$=function(t,e){if(w(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new S(n)},O=b;O.l=_,O.i=w,O.w=function(t,e){return $(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var S=function(){function g(t){this.$L=_(t.locale,null,!0),this.parse(t)}var v=g.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(O.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(p);if(r){var a=r[2]-1||0,o=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],a,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return O},v.isValid=function(){return!(this.$d.toString()===h)},v.isSame=function(t,e){var n=$(t);return this.startOf(e)<=n&&n<=this.endOf(e)},v.isAfter=function(t,e){return $(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<$(t)},v.$g=function(t,e,n){return O.u(t)?this[e]:this.set(n,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var n=this,r=!!O.u(e)||e,l=O.p(t),h=function(t,e){var a=O.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?a:a.endOf(s)},p=function(t,e){return O.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},m=this.$W,g=this.$M,v=this.$D,b="set"+(this.$u?"UTC":"");switch(l){case d:return r?h(1,0):h(31,11);case c:return r?h(1,g):h(0,g+1);case u:var y=this.$locale().weekStart||0,x=(m<y?m+7:m)-y;return h(r?v-x:v+(6-x),g);case s:case f:return p(b+"Hours",0);case i:return p(b+"Minutes",1);case o:return p(b+"Seconds",2);case a:return p(b+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var n,u=O.p(t),l="set"+(this.$u?"UTC":""),h=(n={},n[s]=l+"Date",n[f]=l+"Date",n[c]=l+"Month",n[d]=l+"FullYear",n[i]=l+"Hours",n[o]=l+"Minutes",n[a]=l+"Seconds",n[r]=l+"Milliseconds",n)[u],p=u===s?this.$D+(e-this.$W):e;if(u===c||u===d){var m=this.clone().set(f,1);m.$d[h](p),m.init(),this.$d=m.set(f,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[O.p(t)]()},v.add=function(r,l){var f,h=this;r=Number(r);var p=O.p(l),m=function(t){var e=$(h);return O.w(e.date(e.date()+Math.round(t*r)),h)};if(p===c)return this.set(c,this.$M+r);if(p===d)return this.set(d,this.$y+r);if(p===s)return m(1);if(p===u)return m(7);var g=(f={},f[o]=e,f[i]=n,f[a]=t,f)[p]||1,v=this.$d.getTime()+r*g;return O.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=t||"YYYY-MM-DDTHH:mm:ssZ",a=O.z(this),o=this.$H,i=this.$m,s=this.$M,u=n.weekdays,c=n.months,l=function(t,n,a,o){return t&&(t[n]||t(e,r))||a[n].slice(0,o)},d=function(t){return O.s(o%12||12,t,"0")},f=n.meridiem||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:O.s(s+1,2,"0"),MMM:l(n.monthsShort,s,c,3),MMMM:l(c,s),D:this.$D,DD:O.s(this.$D,2,"0"),d:String(this.$W),dd:l(n.weekdaysMin,this.$W,u,2),ddd:l(n.weekdaysShort,this.$W,u,3),dddd:u[this.$W],H:String(o),HH:O.s(o,2,"0"),h:d(1),hh:d(2),a:f(o,i,!0),A:f(o,i,!1),m:String(i),mm:O.s(i,2,"0"),s:String(this.$s),ss:O.s(this.$s,2,"0"),SSS:O.s(this.$ms,3,"0"),Z:a};return r.replace(m,(function(t,e){return e||p[t]||a.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,f,h){var p,m=O.p(f),g=$(r),v=(g.utcOffset()-this.utcOffset())*e,b=this-g,y=O.m(this,g);return y=(p={},p[d]=y/12,p[c]=y,p[l]=y/3,p[u]=(b-v)/6048e5,p[s]=(b-v)/864e5,p[i]=b/n,p[o]=b/e,p[a]=b/t,p)[m]||b,h?y:O.a(y)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return x[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=_(t,e,!0);return r&&(n.$L=r),n},v.clone=function(){return O.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),M=S.prototype;return $.prototype=M,[["$ms",r],["$s",a],["$m",o],["$H",i],["$W",s],["$M",c],["$y",d],["$D",f]].forEach((function(t){M[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),$.extend=function(t,e){return t.$i||(t(e,S,$),t.$i=!0),$},$.locale=_,$.isDayjs=w,$.unix=function(t){return $(1e3*t)},$.en=x[y],$.Ls=x,$.p={},$}()},u(l={path:c,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&l.path)}},l.exports),l.exports),f=d,h={messagesObj:{},apiBaseUrl:null,participantId:null,studyId:null,auth:{method:"session",apiKey:""},meta:{lastUpdated:null,updates:!1,oldest:null,limit:20},loading:{older:!1,initial:!1,polling:!1,send:!1},authCredentials:function(){return"session"===this.auth.method?{credentials:"include"}:this.auth.apiKey.length>0?{headers:new Headers({Authorization:"Bearer "+this.auth.apiKey})}:void 0},fetchImage:function(t){var e=this;return a(n().mark((function r(){var a,o,i,s;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.authCredentials(),o=Object.assign(a,{method:"GET"}),n.next=4,fetch(t,o);case 4:return i=n.sent,n.next=7,i.blob();case 7:return s=n.sent,n.abrupt("return",URL.createObjectURL(s));case 9:case"end":return n.stop()}}),r)})))()},fetchMessages:function(t){var r=arguments,i=this;return a(n().mark((function a(){var s,u,c,l,d,h,p;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=!(r.length>1&&void 0!==r[1])||r[1],u=i.authCredentials(),c=Object.assign(u,{method:"GET"}),l=new URLSearchParams(Object.assign({study_id:i.studyId,participant_id:i.participantId,order_by:"desc(id)",per_page:i.meta.limit},t)),n.next=6,fetch("".concat(i.apiBaseUrl,"/api/v2/text_messages?")+l,c);case 6:if((d=n.sent).ok){n.next=9;break}throw new Error("womp");case 9:return s&&(i.meta.lastUpdated=f().subtract(1,"second").format("YYYY-MM-DD HH:mm:ss")),n.next=12,d.json();case 12:return(h=n.sent.data).length&&(p=h.reduce((function(t,n){return(!i.meta.oldest||n.created_at<i.meta.oldest)&&(i.meta.oldest=n.created_at),e(e({},t),{},o({},n.id,n))}),{}),i.messagesObj=Object.assign({},i.messagesObj,p)),n.abrupt("return",h);case 15:case"end":return n.stop()}}),a)})))()},loadMessages:function(){var t=this;return a(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading.initial){e.next=2;break}return e.abrupt("return",!1);case 2:return t.loading.initial=!0,e.next=5,t.fetchMessages();case 5:t.loading.initial=!1;case 6:case"end":return e.stop()}}),e)})))()},poll:function(){var t=this;return a(n().mark((function e(){var r,a;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading.polling){e.next=2;break}return e.abrupt("return",!1);case 2:return r={updated_at:"after("+t.meta.lastUpdated+")"},t.loading.polling=!0,e.next=6,t.fetchMessages(r);case 6:a=e.sent,t.loading.polling=!1,a.length&&(t.meta.updates=!0);case 9:case"end":return e.stop()}}),e)})))()},loadOlder:function(){var t=this;return a(n().mark((function e(){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loading.older){e.next=2;break}return e.abrupt("return",!1);case 2:return r={created_at:"before("+t.meta.oldest+")"},t.loading.older=!0,e.next=6,t.fetchMessages(r,!1);case 6:t.loading.older=!1;case 7:case"end":return e.stop()}}),e)})))()},sendMessage:function(t){var e=this;return a(n().mark((function r(){var a,o,i,s,u,c;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.loading.send){n.next=2;break}return n.abrupt("return",!1);case 2:return a={message_text:t},o=e.authCredentials(),i=Object.assign(o,{method:"POST",body:JSON.stringify(a)}),e.loading.send=!0,n.next=8,fetch("".concat(e.apiBaseUrl,"/api/v2/participants/").concat(e.participantId,"/text_messages"),i);case 8:if((s=n.sent).ok){n.next=12;break}throw e.loading.older=!1,new Error("womp");case 12:return n.next=14,s.json();case 14:u=n.sent.data,(c={})[u.id]=u,e.messagesObj=Object.assign({},e.messagesObj,c),e.meta.updates=!0,e.loading.send=!1;case 20:case"end":return n.stop()}}),r)})))()}},p=h,m={inboxSubmit:"btn px-4 btn-primary"},g={statusType:function(t){switch(t.status){case"delivered":case"completed":case"sent":case"received":return"success";case"failed":case"undelivered":return"failure";default:return"unknown"}},messageTime:function(t){var e=t.sent_at||t.created_at;return f(e).format("h:mm A")},tooltipTime:function(t){var e=t.sent_at||t.created_at;return f(e).format("h:mm:ss A")},messageDetailTime:function(t){var e=t.sent_at||t.created_at;return f(e).format("M/D/YY h:mm:ss A")},formatDate:function(t){return f(t).format("~ dddd, D MMMM YYYY ~")},formatNumber:function(t){var e=(""+t).replace(/\D/g,"").match(/^\d{1}(\d{3})(\d{3})(\d{4})$/);return e?e[1]+"-"+e[2]+"-"+e[3]:t},messageClasses:function(t){var e=[];return e.push("inbound"==t.direction?"inbound":"outbound"),e.push(t.sender?"manual":"automated"),e},messageStatus:function(t){switch(t.status){case"queued":case"accepted":return"Text message queued for delivery";case"delivered":case"sent":return"Text message delivered to carrier";case"failed":case"undelivered":return"Text message was not delivered. Error "+t.error_code+": "+t.error_message;default:return t.status}},sortMessages:function(t){return t.sort((function(t,e){return(t.sent_at||t.created_at)>(e.sent_at||e.created_at)?1:(t.sent_at||t.created_at)<(e.sent_at||e.created_at)?-1:t.id>e.id?1:-1}))}},v={name:"LazyImage",props:{store:{type:Object,reruired:!0},url:{type:String,required:!0}},data:function(){return{src:null}},mounted:function(){this.fetch()},methods:{fetch:function(){var t=this;return a(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.store.fetchImage(t.url);case 2:t.src=e.sent;case 3:case"end":return e.stop()}}),e)})))()}}};function b(t,e,n,r,a,o,i,s,u,c){"boolean"!=typeof i&&(u=s,s=i,i=!1);const l="function"==typeof n?n.options:n;let d;if(t&&t.render&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns,l._compiled=!0,a&&(l.functional=!0)),r&&(l._scopeId=r),o?(d=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,u(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},l._ssrRegister=d):e&&(d=i?function(t){e.call(this,c(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,s(t))}),d)if(l.functional){const t=l.render;l.render=function(e,n){return d.call(n),t(e,n)}}else{const t=l.beforeCreate;l.beforeCreate=t?[].concat(t,d):[d]}return n}const y="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function x(t){return(t,e)=>function(t,e){const n=y?e.media||"default":t,r=_[n]||(_[n]={ids:new Set,styles:[]});if(!r.ids.has(t)){r.ids.add(t);let n=e.source;if(e.map&&(n+="\n/*# sourceURL="+e.map.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e.map))))+" */"),r.element||(r.element=document.createElement("style"),r.element.type="text/css",e.media&&r.element.setAttribute("media",e.media),void 0===w&&(w=document.head||document.getElementsByTagName("head")[0]),w.appendChild(r.element)),"styleSheet"in r.element)r.styles.push(n),r.element.styleSheet.cssText=r.styles.filter(Boolean).join("\n");else{const t=r.ids.size-1,e=document.createTextNode(n),a=r.element.childNodes;a[t]&&r.element.removeChild(a[t]),a.length?r.element.insertBefore(e,a[t]):r.element.appendChild(e)}}}(t,e)}let w;const _={};var $=b({render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"component"},[n("div",[n("div",{staticClass:"inbox"},[t.store.loading.older?n("div",{staticClass:"text-center"},[n("b-spinner",{attrs:{variant:"primary",label:"Spinning"}})],1):t._e(),t._v(" "),t._l(t.messagesByDate,(function(e,r){return n("span",{key:r},[n("div",{staticClass:"date"},[t._v(t._s(t.inboxHelper.formatDate(r)))]),t._v(" "),t._l(e,(function(e){return n("span",{key:e.id},[e.sender?n("div",{staticClass:"sender"},[t._v(t._s(e.sender))]):t._e(),t._v(" "),n("div",{staticClass:"message",class:t.inboxHelper.messageClasses(e)},[n("span",{directives:[{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],staticClass:"time",attrs:{title:t.inboxHelper.tooltipTime(e)}},[t._v(t._s(t.inboxHelper.messageTime(e)))]),t._v(" "),n("a",{attrs:{href:"#",id:"icon-"+e.id}},["success"==t.inboxHelper.statusType(e)?n("b-icon",{staticClass:"status-icon",attrs:{icon:"check-lg",variant:"success"}}):t._e(),t._v(" "),"failure"==t.inboxHelper.statusType(e)?n("b-icon",{staticClass:"status-icon",attrs:{icon:"exclamation-triangle-fill",variant:"danger"}}):t._e(),t._v(" "),"unknown"==t.inboxHelper.statusType(e)?n("b-icon",{staticClass:"status-icon",attrs:{icon:"info-circle-fill",variant:"info"}}):t._e()],1),t._v(" "),n("b-popover",{attrs:{target:"icon-"+e.id,title:"Text Message Details",triggers:"click blur",placement:"inbound"==e.direction?"right":"left"},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("Text Message Details")]},proxy:!0}],null,!0)},[t._v(" "),n("strong",[t._v("From:")]),t._v(" "+t._s(t.inboxHelper.formatNumber(e.from_number))),n("br"),t._v(" "),n("strong",[t._v("To:")]),t._v(" "+t._s(t.inboxHelper.formatNumber(e.to_number))),n("br"),t._v(" "),n("strong",[t._v("Status:")]),t._v(" "+t._s(t.inboxHelper.messageStatus(e))),n("br"),t._v(" "),n("strong",[t._v("Sent:")]),t._v(" "+t._s(t.inboxHelper.messageDetailTime(e))+"\n            ")]),t._v("\n            "+t._s(e.message_text)+"\n            "),e.media.length>0?n("ul",{staticClass:"list-inline"},t._l(e.media,(function(r,a){return n("li",{key:r.sid},[n("LazyImage",{attrs:{store:t.store,url:t.getImageUrl(e,a)}})],1)})),0):t._e()],1)])}))],2)}))],2)]),t._v(" "),n("div",[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textContent,expression:"textContent"}],staticClass:"form-control",attrs:{rows:"1",cols:"30",disabled:t.store.loading.send},domProps:{value:t.textContent},on:{input:function(e){e.target.composing||(t.textContent=e.target.value)}}}),t._v(" "),t.store.loading.send?n("div",{staticClass:"disabled",class:t.styleConfig.inboxSubmit},[t._v("\n      Send SMS Message "),n("b-spinner",{attrs:{small:"",variant:"light",label:"Spinning"}})],1):n("input",{class:t.styleConfig.inboxSubmit,attrs:{type:"submit",value:"Send SMS Message",disabled:t.store.loading.send},on:{click:t.sendMessage}})])])},staticRenderFns:[]},(function(t){t&&t("data-v-6f91909a_0",{source:'.component[data-v-6f91909a]{max-height:55vh;min-height:55vh}.inbox[data-v-6f91909a]{max-height:60vh;min-height:60vh;overflow-x:hidden;overflow-y:scroll;border-bottom:2px solid rgba(0,0,0,.2)}.date[data-v-6f91909a]{clear:both;font-size:1.1em;color:gray;text-align:center}.message[data-v-6f91909a]{position:relative;display:inline-block;min-width:150px;max-width:450px;padding:10px 18px;clear:both;vertical-align:top;border-radius:5px;-webkit-box-shadow:0 0 6px #b2b2b2;box-shadow:0 0 6px #b2b2b2}div.sender[data-v-6f91909a]{float:right;margin:0 20px 0 0;clear:both;font-size:12px;color:#6c6f76}.inbound[data-v-6f91909a]{float:left;margin:5px 45px 5px 20px;background-color:#bdf9bd}.inbound[data-v-6f91909a]::before{left:-9px;background-color:#bdf9bd;-webkit-box-shadow:-2px 2px 2px 0 rgba(178,178,178,.4);box-shadow:-2px 2px 2px 0 rgba(178,178,178,.4)}.message[data-v-6f91909a]::before{position:absolute;top:11px;display:block;width:20px;height:16px;content:"\\00a0";-webkit-transform:rotate(29deg) skew(-35deg);-moz-transform:rotate(29deg) skew(-35deg);-ms-transform:rotate(29deg) skew(-35deg);-o-transform:rotate(29deg) skew(-35deg);transform:rotate(29deg) skew(-35deg)}.outbound[data-v-6f91909a]{float:right;margin:5px 20px 5px 45px}.outbound[data-v-6f91909a]::before{right:-9px;-webkit-box-shadow:2px -2px 2px 0 rgb(178 178 178 / 40%);box-shadow:2px -2px 2px 0 rgb(178 178 178 / 40%)}.outbound.automated[data-v-6f91909a],.outbound.automated[data-v-6f91909a]::before{background-color:#e0f1ff}.outbound.manual[data-v-6f91909a],.outbound.manual[data-v-6f91909a]::before{background-color:#badfff}.time[data-v-6f91909a]{float:right;margin:0 3px 0;color:gray}',map:void 0,media:void 0})}),{name:"InboxComponent",components:{LazyImage:b({render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.src?n("img",{staticClass:"inbox-img",attrs:{src:t.src}}):n("div",{staticClass:"inbox-img"},[n("b-spinner",{attrs:{variant:"primary",label:"Spinning"}})],1)])},staticRenderFns:[]},(function(t){t&&t("data-v-0fc50674_0",{source:".inbox-img[data-v-0fc50674]{width:200px;height:200px;margin:20px 0;text-align:center;background-repeat:no-repeat;background-position:50% 50%;-webkit-background-size:cover;background-size:cover}",map:void 0,media:void 0})}),v,"data-v-0fc50674",false,undefined,!1,x,void 0,void 0)},props:{auth:{type:Object,required:!1,default:function(){return{method:"session",apiKey:""}}},apiBaseUrl:{type:String,required:!0},studyId:{type:Number,required:!0},participantId:{type:Number,required:!0},styles:{type:Object,required:!1}},data:function(){return{scrolled:!1,styleConfig:Object.assign(m,this.styles),store:p,inboxHelper:g,textContent:""}},created:function(){var t=this;return a(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.store.apiBaseUrl=t.apiBaseUrl,t.store.participantId=t.participantId,t.store.studyId=t.studyId,t.store.auth=t.auth,t.loading=!0,t.store.loadMessages().then((function(){t.loading=!1,t.scrollToBottom()})).catch((function(e){console.log(e),t.loading=!1}));case 6:case"end":return e.stop()}}),e)})))()},mounted:function(){this.scrollToBottom(),this.handleTop(),this.poll()},computed:{sortedMessages:function(){return Object.keys(this.store.messagesObj).length>0?this.inboxHelper.sortMessages(Object.values(this.store.messagesObj)):[]},messagesByDate:function(){return this.sortedMessages.length?this.sortedMessages.reduce((function(t,e){return(t[e.created_at.split(" ")[0]]=t[e.created_at.split(" ")[0]]||[]).push(e),t}),{}):[]}},watch:{sortedMessages:function(t,e){var n=this;t.length>e.length&&p.meta.updates&&this.$nextTick((function(){n.scrollToBottom(!0)})),p.meta.updates=!1}},methods:{scrollToBottom:function(t){if(!this.scrolled||t){var e,n,r=null===(e=this.$el.querySelector(".inbox"))||void 0===e||null===(n=e.lastElementChild)||void 0===n?void 0:n.lastElementChild;r?(r.scrollIntoView(),this.scrolled=!0):console.log("Failed to find last element")}},handleTop:function(){var t,e=null===(t=this.$el)||void 0===t?void 0:t.querySelector(".inbox");e.onscroll=function(){e&&0===e.scrollTop&&p.loadOlder()}},sendMessage:function(){var t=this;return a(n().mark((function e(){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.textContent.length){e.next=5;break}return e.next=3,t.store.sendMessage(t.textContent);case 3:t.scrollToBottom(!0),t.textContent="";case 5:case"end":return e.stop()}}),e)})))()},getImageUrl:function(t,e){return this.store.apiBaseUrl+"/api/v2/text_messages/"+t.id+"/image/"+e},poll:function(){var t=this;setTimeout((function(){t.store.poll(),t.poll()}),1e4)}}},"data-v-6f91909a",false,undefined,!1,x,void 0,void 0);function O(t){O.installed||(O.installed=!0,t.component("InboxComponent",$))}var S={install:O},M=null;"undefined"!=typeof window?M=window.Vue:"undefined"!=typeof global&&(M=global.Vue),M&&M.use(S);var k=Object.freeze({__proto__:null,install:O,default:$});return Object.entries(k).forEach((function(t){var e=i(t,2),n=e[0],r=e[1];"default"!==n&&(component[n]=r)})),$}();